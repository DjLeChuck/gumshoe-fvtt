name: CI/CD

on:
  push

env:
  PACKAGE_NAME: "investigator"
  MANIFEST_NAME: "system.json"
  # MANIFEST_PATH: "public/${{env.MANIFEST_NAME}}"
  # ZIP_FILE_NAME: "${{PACKAGE_NAME}}.zip"

jobs:
  # build:
  #   name: Build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #     - uses: actions/setup-node@v3
  #       with:
  #         node-version: 18

  #     - name: Activate pnpm
  #       run: corepack enable

  #     - name: Instrumentation
  #       run: |
  #         pwd
  #         ls -l
  #         cat tsconfig.json
  #         export
  #         node --version
  #         pnpm --version

  #     - name: Install dependencies
  #       run: pnpm i

  #     - name: Instrument tsc version
  #       run: npx tsc --version

  #     - name: Test
  #       run: pnpm test

  #     - name: Build
  #       run: pnpm package


  publish:
    # needs: build
    runs-on: ubuntu-latest
    environment: release
    if: github.ref_type == 'tag'
    steps:
      - id: get_tag_version
        uses: actions-ecosystem/action-regex-match@v2.0.2
        with:
          regex: '^refs\/tags\/(v\d+\.\d+\.\d+)(?:-([a-z0-9._-]+))?'
          text: ${{ github.ref }}

      - name: Instrument tags capture
        run: |
          echo "github.ref: ${{ github.ref }}"
          echo "whole match: ${{ steps.get_tag_version.outputs.match }}"
          echo "tag version: ${{ steps.get_tag_version.outputs.group1 }}"
          echo "prerelease: ${{ steps.get_tag_version.outputs.group2 }}"


      # - name: Update Release With Files
      #   uses: ncipollo/release-action@v1
      #   if: env.is_version_tag
      #   with:
      #     allowUpdates: true
      #     name: ${{ github.event.release.name }}
      #     draft: ${{ github.event.release.unpublished }}
      #     prerelease: ${{ github.event.release.prerelease }}
      #     token: ${{ secrets.GITHUB_TOKEN }}
      #     artifacts: './module.json, ./module.zip'
      #     tag: ${{ github.event.release.tag_name }}
      #     body: ${{ github.event.release.body }}
